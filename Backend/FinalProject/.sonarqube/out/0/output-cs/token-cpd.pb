˝
RC:\Users\User\Desktop\Backend\FinalProject\Controllers\SqlConnectionHealthCheck.cs
	namespace 	
FinalProject
 
. 
Controllers "
{ 
public 

class $
SqlConnectionHealthCheck )
:* +
IHealthCheck, 8
{ 
private 
readonly 
IConfiguration '
_config( /
;/ 0
public $
SqlConnectionHealthCheck '
(' (
IConfiguration( 6
config7 =
)= >
{ 	
_config 
= 
config 
; 
} 	
public 
async 
Task 
< 
HealthCheckResult +
>+ ,
CheckHealthAsync- =
(= >
HealthCheckContext> P
contextQ X
,X Y
CancellationTokenZ k
cancellationTokenl }
=~ 
default
Ä á
(
á à
CancellationToken
à ô
)
ô ö
)
ö õ
{ 	
using 
( 
var 

connection !
=" #
new$ '
MySqlConnection( 7
(7 8
_config8 ?
.? @
GetConnectionString@ S
(S T
$strT ]
)] ^
)^ _
)_ `
{   
try!! 
{"" 
await## 

connection## $
.##$ %
	OpenAsync##% .
(##. /
cancellationToken##/ @
)##@ A
;##A B
var$$ 
command$$ 
=$$  !

connection$$" ,
.$$, -
CreateCommand$$- :
($$: ;
)$$; <
;$$< =
command%% 
.%% 
CommandText%% '
=%%( )
$str%%* 4
;%%4 5
await&& 
command&& !
.&&! " 
ExecuteNonQueryAsync&&" 6
(&&6 7
cancellationToken&&7 H
)&&H I
;&&I J
}(( 
catch)) 
()) 
DbException)) "
ex))# %
)))% &
{** 
return++ 
HealthCheckResult++ ,
.++, -
	Unhealthy++- 6
(++6 7
$str++7 E
,++E F
ex++F H
)++H I
;++I J
},, 
}-- 
return.. 
HealthCheckResult.. $
...$ %
Healthy..% ,
(.., -
$str..- 9
)..9 :
;..: ;
}// 	
}00 
}11 ¨_
HC:\Users\User\Desktop\Backend\FinalProject\Controllers\UserController.cs
	namespace 	
FinalProject
 
. 
Controllers "
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
UserController 
:  !
ControllerBase" 0
{ 
private 
readonly 
AppDbContext %
_ctx& *
;* +
public 
UserController 
( 
AppDbContext *
ctx+ .
). /
{ 	
_ctx 
= 
ctx 
; 
} 	
[ 	
HttpGet	 
] 
[ 	
Route	 
( 
$str 
) 
] 
public 
async 
Task 
< 
IActionResult '
>' (
Get) ,
(, -
)- .
{ 	
try   
{!! 
return"" 
Ok"" 
("" 
await"" 
_ctx""  $
.""$ %
Users""% *
.""* +
ToListAsync""+ 6
(""6 7
)""7 8
)""8 9
;""9 :
}## 
catch$$ 
($$ 
	Exception$$ 
)$$ 
{%% 
return&& 
Ok&& 
(&& 
new&& 
	StatusDTO&& '
{'' 
status(( 
=(( 
$str(( M
})) 
))) 
;)) 
}** 
},, 	
[.. 	
HttpGet..	 
].. 
[// 	
Route//	 
(// 
$str// 
)// 
]// 
public00 
async00 
Task00 
<00 
IActionResult00 '
>00' (
GetSpecific00) 4
(004 5
int005 8
id009 ;
)00; <
{11 	
try22 
{33 
User44 
user44 
=44 
await44 !
_ctx44" &
.44& '
Users44' ,
.44, -

FirstAsync44- 7
(447 8
u448 9
=>44: <
u44= >
.44> ?
Id44? A
==44B D
id44E G
)44G H
;44H I
if55 
(55 
user55 
==55 
null55  
)55  !
{66 
return77 
NotFound77 #
(77# $
new77$ '
UserOperationDTO77( 8
{88 
user_id99 
=99  !
id99" $
,99$ %
operation_status:: (
=::) *
$str::+ 1
,::1 2
operation_type;; &
=;;' (
$str;;) .
}<< 
)<< 
;<< 
}== 
return>> 
Ok>> 
(>> 
user>> 
)>> 
;>>  
}?? 
catch@@ 
(@@ 
System@@ 
.@@ 
	Exception@@ #
)@@# $
{AA 
returnCC 
NotFoundCC 
(CC  
newCC  #
UserOperationDTOCC$ 4
{DD 
user_idEE 
=EE 
idEE  
,EE  !
operation_statusFF $
=FF% &
$strFF' -
,FF- .
operation_typeGG "
=GG# $
$strGG% *
}HH 
)HH 
;HH 
}II 
}KK 	
[MM 	
HttpPostMM	 
]MM 
[NN 	
RouteNN	 
(NN 
$strNN 
)NN 
]NN 
publicOO 
asyncOO 
TaskOO 
<OO 
IActionResultOO '
>OO' (
AddOO) ,
(OO, -
UserOO- 1
userOO2 6
)OO6 7
{PP 	
tryQQ 
{RR 
ifSS 
(SS 
userSS 
.SS 
NameSS 
==SS  
nullSS! %
||SS& (
userSS) -
.SS- .
PhoneSS. 3
==SS4 6
nullSS7 ;
)SS; <
{TT 
returnUU 
NotFoundUU #
(UU# $
newUU$ '
UserOperationDTOUU( 8
{VV 
user_idWW 
=WW  !
userWW" &
.WW& '
IdWW' )
,WW) *
operation_statusXX (
=XX) *
$strXX+ 1
,XX1 2
operation_typeYY &
=YY' (
$strYY) .
}ZZ 
)ZZ 
;ZZ 
}[[ 
await\\ 
_ctx\\ 
.\\ 
Users\\  
.\\  !
AddAsync\\! )
(\\) *
user\\* .
)\\. /
;\\/ 0
await]] 
_ctx]] 
.]] 
SaveChangesAsync]] +
(]]+ ,
)]], -
;]]- .
return__ 
Ok__ 
(__ 
new__ 
UserOperationDTO__ .
{`` 
user_idaa 
=aa 
useraa "
.aa" #
Idaa# %
,aa% &
operation_statusbb $
=bb% &
$strbb' 0
,bb0 1
operation_typecc "
=cc# $
$strcc% *
}dd 
)dd 
;dd 
}gg 
catchhh 
(hh 
Systemhh 
.hh 
	Exceptionhh #
)hh# $
{ii 
returnkk 
NotFoundkk 
(kk  
newkk  #
UserOperationDTOkk$ 4
{ll 
user_idmm 
=mm 
usermm "
.mm" #
Idmm# %
,mm% &
operation_statusnn $
=nn% &
$strnn' -
,nn- .
operation_typeoo "
=oo# $
$stroo% *
}pp 
)pp 
;pp 
}qq 
}rr 	
[tt 	

HttpDeletett	 
]tt 
[uu 	
Routeuu	 
(uu 
$struu 
)uu 
]uu 
publicvv 
asyncvv 
Taskvv 
<vv 
IActionResultvv '
>vv' (
Deletevv) /
(vv/ 0
intvv0 3
idvv4 6
)vv6 7
{ww 	
tryxx 
{yy 
Userzz 
userzz 
=zz 
awaitzz !
_ctxzz" &
.zz& '
Userszz' ,
.zz, -

FirstAsynczz- 7
(zz7 8
uzz8 9
=>zz: <
uzz= >
.zz> ?
Idzz? A
==zzB D
idzzE G
)zzG H
;zzH I
if{{ 
({{ 
user{{ 
=={{ 
null{{  
){{  !
{|| 
return}} 
NotFound}} #
(}}# $
new}}$ '
UserOperationDTO}}( 8
{~~ 
user_id 
=  !
id" $
,$ %
operation_status
ÄÄ (
=
ÄÄ) *
$str
ÄÄ+ 1
,
ÄÄ1 2
operation_type
ÅÅ &
=
ÅÅ' (
$str
ÅÅ) 1
}
ÇÇ 
)
ÇÇ 
;
ÇÇ 
}
ÉÉ 
_ctx
ÑÑ 
.
ÑÑ 
Users
ÑÑ 
.
ÑÑ 
Remove
ÑÑ !
(
ÑÑ! "
user
ÑÑ" &
)
ÑÑ& '
;
ÑÑ' (
await
ÖÖ 
_ctx
ÖÖ 
.
ÖÖ 
SaveChangesAsync
ÖÖ +
(
ÖÖ+ ,
)
ÖÖ, -
;
ÖÖ- .
return
ÜÜ 
Ok
ÜÜ 
(
ÜÜ 
new
ÜÜ 
UserOperationDTO
ÜÜ .
{
áá 
user_id
àà 
=
àà 
id
àà  
,
àà  !
operation_status
ââ $
=
ââ% &
$str
ââ' 0
,
ââ0 1
operation_type
ää "
=
ää# $
$str
ää% -
}
ãã 
)
ãã 
;
ãã 
}
åå 
catch
çç 
(
çç 
System
çç 
.
çç 
	Exception
çç #
)
çç# $
{
éé 
return
êê 
NotFound
êê 
(
êê  
new
êê  #
UserOperationDTO
êê$ 4
{
ëë 
user_id
íí 
=
íí 
id
íí  
,
íí  !
operation_status
ìì $
=
ìì% &
$str
ìì' -
,
ìì- .
operation_type
îî "
=
îî# $
$str
îî% -
}
ïï 
)
ïï 
;
ïï 
}
ññ 
}
óó 	
[
ôô 	
	HttpPatch
ôô	 
]
ôô 
[
öö 	
Route
öö	 
(
öö 
$str
öö 
)
öö 
]
öö 
public
õõ 
async
õõ 
Task
õõ 
<
õõ 
IActionResult
õõ '
>
õõ' (
Edit
õõ) -
(
õõ- .
int
õõ. 1
id
õõ2 4
,
õõ4 5
User
õõ6 :
newUser
õõ; B
)
õõB C
{
úú 	
try
ùù 
{
ûû 
User
üü 
user
üü 
=
üü 
await
üü !
_ctx
üü" &
.
üü& '
Users
üü' ,
.
üü, -

FirstAsync
üü- 7
(
üü7 8
u
üü8 9
=>
üü: <
u
üü= >
.
üü> ?
Id
üü? A
==
üüB D
id
üüE G
)
üüG H
;
üüH I
if
†† 
(
†† 
user
†† 
==
†† 
null
††  
)
††  !
{
°° 
return
¢¢ 
NotFound
¢¢ #
(
¢¢# $
new
¢¢$ '
UserOperationDTO
¢¢( 8
{
££ 
user_id
§§ 
=
§§  !
id
§§" $
,
§§$ %
operation_status
•• (
=
••) *
$str
••+ 1
,
••1 2
operation_type
¶¶ &
=
¶¶' (
$str
¶¶) /
}
ßß 
)
ßß 
;
ßß 
}
®® 
if
©© 
(
©© 
newUser
©© 
==
©© 
null
©© #
)
©©# $
{
™™ 
return
´´ 
NotFound
´´ #
(
´´# $
new
´´$ '
UserOperationDTO
´´( 8
{
¨¨ 
user_id
≠≠ 
=
≠≠  !
id
≠≠" $
,
≠≠$ %
operation_status
ÆÆ (
=
ÆÆ) *
$str
ÆÆ+ 1
,
ÆÆ1 2
operation_type
ØØ &
=
ØØ' (
$str
ØØ) /
}
∞∞ 
)
∞∞ 
;
∞∞ 
}
±± 
if
≤≤ 
(
≤≤ 
newUser
≤≤ 
.
≤≤ 
Name
≤≤  
!=
≤≤! #
null
≤≤$ (
)
≤≤( )
{
≥≥ 
user
¥¥ 
.
¥¥ 
Name
¥¥ 
=
¥¥ 
newUser
¥¥  '
.
¥¥' (
Name
¥¥( ,
;
¥¥, -
}
µµ 
if
∂∂ 
(
∂∂ 
newUser
∂∂ 
.
∂∂ 
Phone
∂∂ !
!=
∂∂" $
null
∂∂% )
)
∂∂) *
{
∑∑ 
user
∏∏ 
.
∏∏ 
Phone
∏∏ 
=
∏∏  
newUser
∏∏! (
.
∏∏( )
Phone
∏∏) .
;
∏∏. /
}
ππ 
await
∫∫ 
_ctx
∫∫ 
.
∫∫ 
SaveChangesAsync
∫∫ +
(
∫∫+ ,
)
∫∫, -
;
∫∫- .
return
ªª 
Ok
ªª 
(
ªª 
new
ªª 
UserOperationDTO
ªª .
{
ºº 
user_id
ΩΩ 
=
ΩΩ 
id
ΩΩ  
,
ΩΩ  !
operation_status
ææ $
=
ææ% &
$str
ææ' 0
,
ææ0 1
operation_type
øø "
=
øø# $
$str
øø% +
}
¿¿ 
)
¿¿ 
;
¿¿ 
}
¡¡ 
catch
¬¬ 
(
¬¬ 
System
¬¬ 
.
¬¬ 
	Exception
¬¬ #
)
¬¬# $
{
√√ 
return
≈≈ 
NotFound
≈≈ 
(
≈≈  
new
≈≈  #
UserOperationDTO
≈≈$ 4
{
∆∆ 
user_id
«« 
=
«« 
id
««  
,
««  !
operation_status
»» $
=
»»% &
$str
»»' -
,
»»- .
operation_type
…… "
=
……# $
$str
……% +
}
   
)
   
;
   
}
ÀÀ 
}
ÃÃ 	
}
œœ 
}–– ü
>C:\Users\User\Desktop\Backend\FinalProject\DAL\AppDbContext.cs
	namespace 	
FinalProject
 
. 
DAL 
{ 
public 

class 
AppDbContext 
: 
	DbContext '
{ 
public 
AppDbContext 
( 
DbContextOptions ,
<, -
AppDbContext- 9
>9 :
options; B
)B C
:D E
baseF J
(J K
optionsK R
)R S
{		 	
} 	
public 
DbSet 
< 
User 
> 
Users  
{! "
get# &
;& '
set( +
;+ ,
}- .
} 
} Í
?C:\Users\User\Desktop\Backend\FinalProject\DAL\Entities\User.cs
	namespace 	
FinalProject
 
. 
DAL 
. 
Entities #
{ 
public 

class 
User 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public		 
string		 
Phone		 
{		 
get		 !
;		! "
set		# &
;		& '
}		( )
}

 
} û
<C:\Users\User\Desktop\Backend\FinalProject\DTOs\StatusDTO.cs
	namespace 	
FinalProject
 
. 
DTOs 
{ 
public 

class 
	StatusDTO 
{ 
public 
string 
status 
{ 
get "
;" #
set$ '
;' (
}) *
} 
} 
CC:\Users\User\Desktop\Backend\FinalProject\DTOs\UserOperationDTO.cs
	namespace 	
FinalProject
 
. 
DTOs 
{ 
public 

class 
UserOperationDTO !
{ 
public 
int 
user_id 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
operation_status &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
string 
operation_type $
{% &
get' *
;* +
set, /
;/ 0
}1 2
} 
}		 è

5C:\Users\User\Desktop\Backend\FinalProject\Program.cs
	namespace

 	
FinalProject


 
{ 
public 

class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	
CreateHostBuilder 
( 
args "
)" #
.# $
Build$ )
() *
)* +
.+ ,
Run, /
(/ 0
)0 1
;1 2
} 	
public 
static 
IHostBuilder "
CreateHostBuilder# 4
(4 5
string5 ;
[; <
]< =
args> B
)B C
=>D F
Host 
.  
CreateDefaultBuilder %
(% &
args& *
)* +
. $
ConfigureWebHostDefaults )
() *

webBuilder* 4
=>5 7
{ 

webBuilder 
. 

UseStartup )
<) *
Startup* 1
>1 2
(2 3
)3 4
;4 5
} 
) 
; 
} 
} ü2
5C:\Users\User\Desktop\Backend\FinalProject\Startup.cs
	namespace 	
FinalProject
 
{ 
public 

class 
Startup 
{ 
public 
Startup 
( 
IConfiguration %
configuration& 3
)3 4
{ 	
Configuration 
= 
configuration )
;) *
} 	
public 
IConfiguration 
Configuration +
{, -
get. 1
;1 2
}3 4
public"" 
void"" 
ConfigureServices"" %
(""% &
IServiceCollection""& 8
services""9 A
)""A B
{## 	
services$$ 
.$$ 
AddControllers$$ #
($$# $
)$$$ %
.$$% &
AddNewtonsoftJson$$& 7
($$7 8
options$$8 ?
=>$$@ B
options%% 
.%% 
SerializerSettings%% .
.%%. /!
ReferenceLoopHandling%%/ D
=%%E F

Newtonsoft%%G Q
.%%Q R
Json%%R V
.%%V W!
ReferenceLoopHandling%%W l
.%%l m
Ignore%%m s
)%%s t
;%%t u
services'' 
.'' 
AddDbContext'' !
<''! "
AppDbContext''" .
>''. /
(''/ 0
options''0 7
=>''8 :
{(( 
options)) 
.)) 
UseMySql))  
())  !
Configuration))! .
.)). /
GetConnectionString))/ B
())B C
$str))C L
)))L M
,))M N
new))O R
MySqlServerVersion))S e
())e f
new))f i
Version))j q
())q r
$num))r s
,))s t
$num))u v
,))v w
$num))x z
)))z {
))){ |
)))| }
;))} ~
}** 
)** 
;** 
services-- 
.-- 
AddHttpClient-- "
(--" #
)--# $
;--$ %
services.. 
... 
AddCors.. 
(.. 
options.. $
=>..% '
{// 
options00 
.00 
AddDefaultPolicy00 (
(00( )
builder11 
=>11 
{22 
builder33 
.33  
AllowAnyOrigin33  .
(33. /
)33/ 0
.330 1
AllowAnyHeader331 ?
(33? @
)33@ A
.33A B
AllowAnyMethod33B P
(33P Q
)33Q R
;33R S
}44 
)44 
;44 
}55 
)55 
;55 
services66 
.66 
AddHealthChecks66 $
(66$ %
)66% &
.66& '
AddCheck66' /
<66/ 0$
SqlConnectionHealthCheck660 H
>66H I
(66I J
$str66J `
)66` a
;66a b
}77 	
public:: 
void:: 
	Configure:: 
(:: 
IApplicationBuilder:: 1
app::2 5
,::5 6
IWebHostEnvironment::7 J
env::K N
)::N O
{;; 	
if<< 
(<< 
env<< 
.<< 
IsDevelopment<< !
(<<! "
)<<" #
)<<# $
{== 
app>> 
.>> %
UseDeveloperExceptionPage>> -
(>>- .
)>>. /
;>>/ 0
}?? 
varAA 
builderAA 
=AA 
newAA  
ConfigurationBuilderAA 2
(AA2 3
)AA3 4
.BB 
SetBasePathBB 
(BB 
envBB  
.BB  !
ContentRootPathBB! 0
)BB0 1
.CC 
AddJsonFileCC 
(CC 
$strCC /
,CC/ 0
optionalCC1 9
:CC9 :
trueCC; ?
,CC? @
reloadOnChangeCCA O
:CCO P
trueCCQ U
)CCU V
.DD 
AddJsonFileDD 
(DD 
$"DD 
$strDD +
{DD+ ,
envDD, /
.DD/ 0
EnvironmentNameDD0 ?
}DD? @
$strDD@ E
"DDE F
,DDF G
optionalDDH P
:DDP Q
trueDDR V
)DDV W
.EE #
AddEnvironmentVariablesEE (
(EE( )
)EE) *
;EE* +
appGG 
.GG 
UseHttpsRedirectionGG #
(GG# $
)GG$ %
;GG% &
appII 
.II 

UseRoutingII 
(II 
)II 
;II 
appJJ 
.JJ 
UseCorsJJ 
(JJ 
)JJ 
;JJ 
varLL 
optionsLL 
=LL 
newLL 
HealthCheckOptionsLL 0
(LL0 1
)LL1 2
;LL2 3
optionsMM 
.MM 
ResponseWriterMM "
=MM# $
asyncMM% *
(MM+ ,
cMM, -
,MM- .
rMM/ 0
)MM0 1
=>MM2 4
{NN 
cOO 
.OO 
ResponseOO 
.OO 
ContentTypeOO &
=OO' (
$strOO) ;
;OO; <
varQQ 
resultQQ 
=QQ 
JsonConvertQQ (
.QQ( )
SerializeObjectQQ) 8
(QQ8 9
newQQ9 <
{RR 
statusSS 
=SS 
(SS 
rSS 
.SS  
StatusSS  &
.SS& '
ToStringSS' /
(SS/ 0
)SS0 1
==SS2 4
$strSS5 >
?SS? @
$strSSA E
:SSF G
$strSSH N
)SSN O
,SSO P
}TT 
)TT 
;TT 
awaitUU 
cUU 
.UU 
ResponseUU  
.UU  !

WriteAsyncUU! +
(UU+ ,
resultUU, 2
)UU2 3
;UU3 4
}VV 
;VV 
appXX 
.XX 
UseHealthChecksXX 
(XX  
$strXX  )
,XX) *
optionsXX+ 2
)XX2 3
;XX3 4
appZZ 
.ZZ 
UseAuthorizationZZ  
(ZZ  !
)ZZ! "
;ZZ" #
app\\ 
.\\ 
UseEndpoints\\ 
(\\ 
	endpoints\\ &
=>\\' )
{]] 
	endpoints^^ 
.^^ 
MapControllers^^ (
(^^( )
)^^) *
;^^* +
}__ 
)__ 
;__ 
}`` 	
}aa 
}bb 